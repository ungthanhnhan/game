<script>
    const joystickContainer = document.getElementById("joystick-container");
    const joystick = document.getElementById("joystick");
    const square = document.getElementById("square");

    let joystickActive = false;
    let squarePos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };

    // Bắt đầu điều khiển joystick
    joystickContainer.addEventListener("touchstart", (e) => {
        joystickActive = true;
        const rect = joystickContainer.getBoundingClientRect();
        const touchX = e.touches[0].clientX - rect.left;
        const touchY = e.touches[0].clientY - rect.top;

        joystick.style.transition = "none"; // Ngắt hiệu ứng trả về để theo tay nhanh hơn
        joystick.style.left = `${Math.min(Math.max(touchX - joystick.offsetWidth / 2, 0), rect.width - joystick.offsetWidth)}px`;
        joystick.style.top = `${Math.min(Math.max(touchY - joystick.offsetHeight / 2, 0), rect.height - joystick.offsetHeight)}px`;
    });

    // Di chuyển joystick theo tay người dùng
    joystickContainer.addEventListener("touchmove", (e) => {
        if (!joystickActive) return;

        const rect = joystickContainer.getBoundingClientRect();
        const touchX = e.touches[0].clientX - rect.left;
        const touchY = e.touches[0].clientY - rect.top;

        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        const dx = touchX - centerX;
        const dy = touchY - centerY;

        const distance = Math.min(Math.sqrt(dx * dx + dy * dy), rect.width / 2 - joystick.offsetWidth / 2);
        const angle = Math.atan2(dy, dx);

        const offsetX = Math.cos(angle) * distance;
        const offsetY = Math.sin(angle) * distance;

        joystick.style.left = `${centerX + offsetX - joystick.offsetWidth / 2}px`;
        joystick.style.top = `${centerY + offsetY - joystick.offsetHeight / 2}px`;

        // Di chuyển vật thể
        squarePos.x = Math.max(0, Math.min(window.innerWidth - square.offsetWidth, squarePos.x + offsetX / 10));
        squarePos.y = Math.max(0, Math.min(window.innerHeight - square.offsetHeight, squarePos.y + offsetY / 10));
        square.style.left = `${squarePos.x}px`;
        square.style.top = `${squarePos.y}px`;
    });

    // Trả joystick về vị trí trung tâm
    joystickContainer.addEventListener("touchend", () => {
        joystickActive = false;
        joystick.style.transition = "left 0.2s, top 0.2s"; // Hiệu ứng trả về tâm
        joystick.style.left = "50%";
        joystick.style.top = "50%";
    });
</script>
